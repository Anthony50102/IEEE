# =============================================================================
# OpInf Pipeline Configuration
# =============================================================================
# This configuration file controls the end-to-end Operator Inference ROM
# pipeline for the Hasegawa-Wakatani equations.
#
# Usage:
#   python step_1_preprocess.py --config config.yaml
#   mpirun -np 56 python step_2_train_rom.py --config config.yaml
#   python step_3_evaluate.py --config config.yaml
#   python run_pipeline.py --config config.yaml  # runs all steps
# =============================================================================

# -----------------------------------------------------------------------------
# Run identification
# -----------------------------------------------------------------------------
run_name: "hw_rom_experiment_10and2_parallel_step1"  # Used for output directory naming
                               # Leave empty for auto-generated timestamp

# -----------------------------------------------------------------------------
# Data paths
# -----------------------------------------------------------------------------
paths:
  # Base output directory - a timestamped subdirectory will be created here
  output_base: "/Users/anthonypoole/Repositories/IEEE/local_output"
  
  # Raw simulation data directory
  data_dir: "/Users/anthonypoole/Repositories/IEEE/data/hw2d"
  
  # Training data files (list of h5 files)
  training_files: 
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315142044_11702_0.h5     
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315171533_30878_0.h5
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315142045_4677_2.h5      
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315221115_13688_1.h5
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315142047_27930_0.h5     
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315230232_31225_0.h5
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315151019_22903_1.h5     
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315230233_24771_1.h5
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315165458_9483_0.h5      
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315230235_27329_3.h5

  
  # Test data files (list of h5 files)
  test_files:
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315165459_26121_3.h5     
      - hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315234810_19315_1.h5
# -----------------------------------------------------------------------------
# Physics parameters
# -----------------------------------------------------------------------------
physics:
  dt: 0.025                     # Simulation time step
  n_fields: 2                   # Number of fields (density, phi)
  n_x: 256                      # Grid points in x
  n_y: 256                      # Grid points in y

# -----------------------------------------------------------------------------
# POD parameters
# -----------------------------------------------------------------------------
pod:
  r: 100                        # Number of POD modes to retain
  svd_save: 250                # Number of singular values to save
  
# -----------------------------------------------------------------------------
# Data truncation 
# -----------------------------------------------------------------------------
truncation:
  enabled: true                 # Enable/disable truncation
  method: "time"                # "snapshots" or "time"
  snapshots: null               # Number of snapshots to keep (if method="snapshots")
  time: 200.0                   # Simulation time to keep (if method="time")

# -----------------------------------------------------------------------------
# ROM training parameters
# -----------------------------------------------------------------------------
training:
  training_end: 8000            # Index marking end of training region
  n_steps: 8000                # Number of time steps for integration

# -----------------------------------------------------------------------------
# Regularization sweep parameters
# -----------------------------------------------------------------------------
regularization:
  # State operator regularization
  state_lin:
    min: 1.0e-2
    max: 1.0e6
    num: 15
    scale: "linear"             # "linear" or "log"
  
  state_quad:
    min: 1.0e7
    max: 1.0e15
    num: 15
    scale: "linear"
  
  # Output operator regularization
  output_lin:
    min: 1.0e-8
    max: 1.0e1
    num: 15
    scale: "linear"
  
  output_quad:
    min: 1.0e-10
    max: 1.0e1
    num: 15
    scale: "linear"

# -----------------------------------------------------------------------------
# Model selection
# -----------------------------------------------------------------------------
model_selection:
  method: "threshold"           # "top_k" or "threshold"
  
  # top_k parameters
  num_top_models: 20            # Number of top models to keep
  
  # threshold parameters
  threshold_mean: 0.08          # Maximum relative error in mean (5%)
  threshold_std: 0.5           # Maximum relative error in std (30%)

# -----------------------------------------------------------------------------
# Evaluation parameters
# -----------------------------------------------------------------------------
evaluation:
  compute_full_state: false     # Reconstruct full-order state (memory intensive)
  save_predictions: true        # Save ensemble predictions
  generate_plots: true          # Generate diagnostic plots

# -----------------------------------------------------------------------------
# Execution settings
# -----------------------------------------------------------------------------
execution:
  verbose: true                 # Print progress information
  log_level: "INFO"             # Logging level: DEBUG, INFO, WARNING, ERROR
  engine: "h5netcdf"            # HDF5 engine for xarray
