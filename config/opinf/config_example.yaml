# =============================================================================
# OpInf Pipeline Configuration
# =============================================================================
# This configuration file controls the end-to-end Operator Inference ROM
# pipeline for the Hasegawa-Wakatani equations.
#
# Usage:
#   python step_1_preprocess.py --config config.yaml
#   mpirun -np 56 python step_2_train_rom.py --config config.yaml
#   python step_3_evaluate.py --config config.yaml
#   python run_pipeline.py --config config.yaml  # runs all steps
# =============================================================================

# -----------------------------------------------------------------------------
# Run identification
# -----------------------------------------------------------------------------
run_name: "hw_rom_experiment"  # Used for output directory naming
                               # Leave empty for auto-generated timestamp

# -----------------------------------------------------------------------------
# Data paths
# -----------------------------------------------------------------------------
paths:
  # Base output directory - a timestamped subdirectory will be created here
  output_base: "/scratch2/10407/anthony50102/IEEE/output/"
  
  # Raw simulation data directory
  data_dir: "/work2/10407/anthony50102/frontera/data/hw2d_sim/t600_d256x256_raw/"
  
  # Training data files (list of h5 files)
  training_files:
    - "hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250315142044_11702_0.h5"
  
  # Test data files (list of h5 files)
  test_files:
    - "hw2d_sim_step0.025_end1_pts512_c11_k015_N3_nu5e-8_20250316085602_1116_2.h5"

# -----------------------------------------------------------------------------
# Physics parameters
# -----------------------------------------------------------------------------
physics:
  dt: 0.025                     # Simulation time step
  n_fields: 2                   # Number of fields (density, phi)
  n_x: 512                      # Grid points in x
  n_y: 512                      # Grid points in y

# -----------------------------------------------------------------------------
# POD parameters
# -----------------------------------------------------------------------------
pod:
  r: 100                        # Number of POD modes to retain
  svd_save: 100                 # Number of singular values to save
  
# -----------------------------------------------------------------------------
# Data truncation 
# -----------------------------------------------------------------------------
truncation:
  enabled: true                 # Enable/disable truncation
  method: "time"                # "snapshots" or "time"
  snapshots: null               # Number of snapshots to keep (if method="snapshots")
  time: 200.0                   # Simulation time to keep (if method="time")

# -----------------------------------------------------------------------------
# ROM training parameters
# -----------------------------------------------------------------------------
training:
  training_end: 5000            # Index marking end of training region
  n_steps: 16001                # Number of time steps for integration

# -----------------------------------------------------------------------------
# Regularization sweep parameters
# -----------------------------------------------------------------------------
regularization:
  # State operator regularization
  state_lin:
    min: 1.0e-2
    max: 1.0e3
    num: 12
    scale: "linear"             # "linear" or "log"
  
  state_quad:
    min: 1.0e7
    max: 1.0e12
    num: 12
    scale: "linear"
  
  # Output operator regularization
  output_lin:
    min: 1.0e-8
    max: 1.0e-2
    num: 12
    scale: "linear"
  
  output_quad:
    min: 1.0e-10
    max: 1.0e-2
    num: 12
    scale: "linear"

# -----------------------------------------------------------------------------
# Model selection
# -----------------------------------------------------------------------------
model_selection:
  method: "threshold"           # "top_k" or "threshold"
  
  # top_k parameters
  num_top_models: 20            # Number of top models to keep
  
  # threshold parameters
  threshold_mean: 0.05          # Maximum relative error in mean (5%)
  threshold_std: 0.30           # Maximum relative error in std (30%)

# -----------------------------------------------------------------------------
# Evaluation parameters
# -----------------------------------------------------------------------------
evaluation:
  compute_full_state: false     # Reconstruct full-order state (memory intensive)
  save_predictions: true        # Save ensemble predictions
  generate_plots: true          # Generate diagnostic plots

# -----------------------------------------------------------------------------
# Execution settings
# -----------------------------------------------------------------------------
execution:
  verbose: true                 # Print progress information
  log_level: "INFO"             # Logging level: DEBUG, INFO, WARNING, ERROR
  engine: "h5netcdf"            # HDF5 engine for xarray
