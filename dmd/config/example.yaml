# =============================================================================
# DMD Pipeline Configuration
# =============================================================================
# This configuration file controls all parameters for the BOPDMD ROM pipeline.
#
# Usage:
#   mpirun -np 4 python step_1_preprocess.py --config config.yaml
#   python step_2_train.py --config config.yaml --run-dir /path
#   python step_3_evaluate.py --config config.yaml --run-dir /path
# =============================================================================

run_name: "example"

# =============================================================================
# DATA PATHS
# =============================================================================
paths:
  output_base: "/scratch/user/output/"       # Base directory for outputs
  data_dir: "/scratch/user/data/hw2d/"       # Directory containing HDF5 files
  
  training_files:
    - simulation_001.h5
  
  test_files:
    - simulation_002.h5
    - simulation_003.h5

# =============================================================================
# PHYSICS PARAMETERS
# =============================================================================
physics:
  dt: 0.025              # Simulation time step
  n_fields: 2            # Number of fields (e.g., density, phi)
  n_x: 256               # Grid points in x
  n_y: 256               # Grid points in y

# =============================================================================
# DIMENSIONALITY REDUCTION (POD)
# =============================================================================
reduction:
  method: "linear"       # Only "linear" (POD) supported for DMD
  r: 75                  # Number of POD modes to retain
  target_energy: 0.9999  # Alternative to fixed r

# =============================================================================
# DMD-SPECIFIC SETTINGS
# =============================================================================
dmd:
  # Training mode: "multi_trajectory" or "temporal_split"
  training_mode: "multi_trajectory"
  
  # Only used if training_mode="temporal_split":
  train_start: 8000      # Train from this snapshot
  train_end: 16000       # Train to this snapshot
  test_start: 16000      # Test from this snapshot
  test_end: 24000        # Test to this snapshot
  
  rank: null             # DMD rank (null = use same as POD r)
  num_trials: 0          # Bagging trials for BOPDMD (0 = standard DMD)
  use_proj: true         # Use POD projection in BOPDMD
  eig_sort: "real"       # Eigenvalue sorting: "real", "imag", "abs"
  
  # Physics parameters for Gamma computation
  k0: 0.15               # Wavenumber for grid spacing (dx = 2*pi/k0)
  c1: 1.0                # Adiabaticity parameter for Gamma_c

# =============================================================================
# DATA TRUNCATION
# =============================================================================
truncation:
  enabled: true          # Enable time truncation of trajectories
  method: "time"         # "time" (seconds) or "snapshots" (count)
  time: 200.0            # Truncate to this simulation time
  snapshots: null        # Or truncate to this many snapshots

# =============================================================================
# OUTPUT MODEL
# =============================================================================
# Controls whether the ROM learns output operators (C, G, c) for Gamma prediction.
# If disabled, Gamma is computed from physics (reconstructing full state from POD).
# =============================================================================
output_model:
  enabled: false         # Learn quadratic output operators for Gamma
  alpha_lin: 1.0e-4      # Regularization for linear output terms
  alpha_quad: 1.0e-4     # Regularization for quadratic output terms

# =============================================================================
# PREPROCESSING
# =============================================================================
preprocessing:
  centering: true        # Subtract temporal mean (RECOMMENDED for POD)
  scaling: false         # Normalize each field to [-1, 1]

# =============================================================================
# TRAINING PARAMETERS
# =============================================================================
training:
  training_end: 8000     # Index marking end of training region
  n_steps: 8000          # Number of time steps for DMD integration

# =============================================================================
# REGULARIZATION (for compatibility with shared preprocessing)
# =============================================================================
regularization:
  state_lin: {min: 1.0e-4, max: 1.0e6, num: 1, scale: "linear"}
  state_quad: {min: 1.0e5, max: 1.0e15, num: 1, scale: "linear"}
  output_lin: {min: 1.0e-10, max: 1.0e1, num: 1, scale: "linear"}
  output_quad: {min: 1.0e-12, max: 1.0e1, num: 1, scale: "linear"}

# =============================================================================
# MODEL SELECTION (not used for DMD, kept for compatibility)
# =============================================================================
model_selection:
  method: "top_k"
  num_top_models: 1
  threshold_mean: 0.05
  threshold_std: 0.4

# =============================================================================
# EVALUATION OPTIONS
# =============================================================================
evaluation:
  save_predictions: true   # Save DMD predictions to disk
  generate_plots: true     # Generate Gamma diagnostic plots
  plot_state_error: false  # Generate L2 state error over time plots
  plot_state_snapshots: false  # Generate 2D snapshot comparison plots
  n_snapshot_samples: 5    # Number of snapshots for comparison

# =============================================================================
# EXECUTION OPTIONS
# =============================================================================
execution:
  verbose: true          # Print progress information
  log_level: "INFO"      # DEBUG, INFO, WARNING, ERROR
  engine: "h5netcdf"     # HDF5 engine for xarray
